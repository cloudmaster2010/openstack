# Introduction(This page is under construction)
This guide describes things like the following:
1. How to install OpenStack with trove(dbaas) on ubuntu 20.04 using devstack. For this, the following services are required.
   - Nova
   - Cinder
   - Swift
   - Neutron
    
2. Navigate and manage the dashboard after installation of openstack with trove(dbaas).    
   - Login
   - Create network
   - Create cirros VM
   - Create DB VMs
   - See if cirros VMs and DB VMs are running.

3. Network test between containers with cli.   
   - Check the list of instances such cirros and db.
   - Log in to DB and load the data into the db that is running.

## Setup OpenStack environment with trove.
1. Environment
  1) OS : ubuntu 20.04 server LTS
  2) Installer : devstack
  3) Network : 3 networks
    - management(InternalAPI, dashboard)
    - provider(Service)
    - external(Internet)

```sh
sudo -i
hostnamectl set-hostname trove.test.com
hostnamectl set-hostname trove.test.com --transient


HOST_IP="$(ip -4 -o a | grep brd | head -n1 | awk '{print $4}' | cut -f1 -d'/')"
sudo echo "$HOST_IP  trove.test.com zun-kata" >> /etc/hosts

useradd -s /bin/bash -d /opt/stack -m stack
echo "stack ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/stack

su - stack

git clone https://opendev.org/openstack/devstack /opt/stack/devstack -b stable/xena

cd /opt/stack/devstack
cat <<EOF > local.conf
[[local|localrc]]
HOST_IP=172.17.1.95
DATABASE_PASSWORD=password
RABBIT_PASSWORD=password
SERVICE_PASSWORD=password
SERVICE_TOKEN=password
ADMIN_PASSWORD=password
enable_plugin trove https://opendev.org/openstack/trove stable/xena
enable_plugin trove-dashboard https://opendev.org/openstack/trove-dashboard stable/xena
LIBS_FROM_GIT+=,python-troveclient

ENABLED_SERVICES+=,swift
SWIFT_HASH=66a3d6b56c1f479c8b4e70ab5c2000f5
SWIFT_REPLICAS=1
EOF

HOST_IP="$(ip -4 -o a | grep brd | head -n1 | awk '{print $4}' | cut -f1 -d'/')"
sed -i "s/HOST_IP=.*/HOST_IP=$HOST_IP/" /opt/stack/devstack/local.conf

./stack.sh
```
Installation is going to take a while. It installs a bunch of packages, clones a bunch of git repos, and installs everything from these git repos.



# Troubleshooting
#### Error #1
ERROR: Cannot uninstall 'pexpect'. It is a distutils installed project and thus we cannot accurately determine which files belong to it which would lead to only a partial uninstall.
#### Workaround for Error #1:
sudo pip install --ignore-installed -U pexpect

#### Error #2

#### Workaround for Error #2:
This issue is caused by the hostname of the compute node not matching the hostname in the Open_vSwitch table in OVS. 
Change the hostname of Open_vSwitch table in OVS with the hostname of compute node.     
# hostname
trove.test.com
```sh
root@trove:~# ovs-vsctl list open_vswitch
_uuid               : 2f5334a6-881a-4070-aafa-cfe8976dd860
bridges             : [4897f18a-b312-476c-8cc2-b30c7ed0fb24, db7ea1d9-09b1-4994-8d21-b2e1f5d5814f]
cur_cfg             : 5
datapath_types      : [netdev, system]
datapaths           : {}
db_version          : "8.2.0"
dpdk_initialized    : false
dpdk_version        : none
external_ids        : {hostname=trove, ovn-bridge=br-int, ovn-bridge-mappings="public:br-ex", ovn-cms-options=enable-chassis-as-gw, ovn-encap-ip="172.17.1.95", ovn-encap-type=geneve, ovn-remote="tcp:172.17.1.95:6642", rundir="/var/run/openvswitch", system-id="8f791527-d327-4bf6-8beb-5f30bc53915b"}
iface_types         : [erspan, geneve, gre, internal, ip6erspan, ip6gre, lisp, patch, stt, system, tap, vxlan]
manager_options     : [a0a2df05-71c6-44bc-9a1e-3172477076c9]
next_cfg            : 5
other_config        : {}
ovs_version         : "2.13.3"
ssl                 : []
statistics          : {}
system_type         : ubuntu
system_version      : "20.04"

root@trove:~# ovs-vsctl set open . external-ids:hostname=trove.test.com
root@trove:~# hostname
trove.test.com
root@trove:~# ovs-vsctl list open_vswitch
_uuid               : 2f5334a6-881a-4070-aafa-cfe8976dd860
bridges             : [4897f18a-b312-476c-8cc2-b30c7ed0fb24, db7ea1d9-09b1-4994-8d21-b2e1f5d5814f]
cur_cfg             : 7
datapath_types      : [netdev, system]
datapaths           : {}
db_version          : "8.2.0"
dpdk_initialized    : false
dpdk_version        : none
external_ids        : {hostname=trove.test.com, ovn-bridge=br-int, ovn-bridge-mappings="public:br-ex", ovn-cms-options=enable-chassis-as-gw, ovn-encap-ip="172.17.1.95", ovn-encap-type=geneve, ovn-remote="tcp:172.17.1.95:6642", rundir="/var/run/openvswitch", system-id="8f791527-d327-4bf6-8beb-5f30bc53915b"}
iface_types         : [erspan, geneve, gre, internal, ip6erspan, ip6gre, lisp, patch, stt, system, tap, vxlan]
manager_options     : [a0a2df05-71c6-44bc-9a1e-3172477076c9]
next_cfg            : 7
other_config        : {}
ovs_version         : "2.13.3"
ssl                 : []
statistics          : {}
system_type         : ubuntu
system_version      : "20.04"
```

